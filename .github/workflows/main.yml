# CI Workflow for building and pushing a Docker image
#
# This workflow is triggered on push events to the `main` branch.
# It builds a Docker image using the `docker build` command and pushes it to a registry.
#
# Example:
# This workflow can be used to automate the build and deployment of a Go application.
# For example, if you have a Go application in the `main` branch of your repository,
# this workflow will build a Docker image with the latest code changes and push it to a registry.

name: CI

on:
  push:
    branches:
      - main

jobs:
  build-and-push:
    name: "Build and Push"
    runs-on: ubuntu-latest

    steps:
      # Recuperar o código
      # Checkout the code in the repository
      - name: Checkout
        uses: actions/checkout@v4

      #gerar tag de acordo com commit
      - name: Generate SHA
        id: generate_sha
        run: |
          SHA=${GITHUB_SHA:0:7}
          echo "sha=$SHA" >> $GITHUB_OUTPUT

      # Build a Docker image with the latest code changes
      - name: "Build docker image"
        # Recuperar SHA pela ID do step responsável, outputs acessando a varíavel criada sha
        run: docker build -t carllos166/nlw-devops-go:${{ steps.generate_sha.outputs.sha }} .
        

      #logar n ocontainer registry
      #enviar imagem após